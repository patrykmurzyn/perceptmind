---
import Layout from '../layouts/Layout.astro';
import NeuralBackground from '../components/NeuralBackground.astro';
import Navbar from '../components/Navbar.astro';
import Contact from '../components/Contact.astro';
---

<Layout
  title="PerceptMind | AI Solutions for Business"
  description="PerceptMind helps businesses deliver measurable outcomes with practical AI solutions."
  canonicalUrl="https://perceptmind.com/"
  ogImage="/favicon.svg"
>
  <Navbar />
  <NeuralBackground />

  <main>
    <h1 class="title title-top">Percept</h1>
    <h1 class="title title-bottom">
      M<span class="i-container"><span class="i" id="mind-i">!</span></span>nd
    </h1>
    <h2 class="subtitle">
      <div class="subtitle-content">
        <span>AI Solutions for</span>
        <span id="changing-text" class="highlight-text">Business</span>
      </div>
    </h2>
  </main>

  <section class="vertical-stack" id="vertical-stack">
    <div class="vertical-track" id="vertical-track">
      <section class="vertical-panel panel-1">
        <div class="panel-background-text">PURE EFFICIENCY</div>
        <div class="panel-content">
          <div class="panel-icon-wrapper large-icon">
            <svg width="240" height="240" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Glow -->
              <circle cx="100" cy="100" r="80" fill="#F59E0B" fill-opacity="0.05" filter="blur(30px)" />
              
              <!-- Outer Rotating Gear Segments -->
              <g id="auto-gear-outer">
                <g id="auto-gear-segments">
                  <path d="M100 20C105 20 110 21 115 23" stroke="#F59E0B" stroke-width="3" stroke-linecap="round"/>
                  <path d="M100 180C95 180 90 179 85 177" stroke="#F59E0B" stroke-width="3" stroke-linecap="round"/>
                  <path d="M20 100C20 95 21 90 23 85" stroke="#F59E0B" stroke-width="3" stroke-linecap="round"/>
                  <path d="M180 100C180 105 179 110 177 115" stroke="#F59E0B" stroke-width="3" stroke-linecap="round"/>
                </g>
                
                <circle id="auto-outer-ring" cx="100" cy="100" r="60" stroke="#F59E0B" stroke-width="1" stroke-dasharray="4 6" stroke-opacity="0.4"/>
              </g>

              <!-- Inner Spinning Mechanics -->
              <g id="auto-mechanics">
                <circle id="auto-inner-ring" cx="100" cy="100" r="50" stroke="#FBBF24" stroke-width="2" stroke-dasharray="10 10" stroke-opacity="0.6"/>
                <circle cx="100" cy="50" r="4" fill="#FBBF24"/>
                <circle cx="100" cy="150" r="4" fill="#FBBF24"/>
                <circle cx="50" cy="100" r="4" fill="#FBBF24"/>
                <circle cx="150" cy="100" r="4" fill="#FBBF24"/>
              </g>

              <!-- Central AI Chip (Processing) -->
              <g id="auto-chip">
                <rect x="75" y="75" width="50" height="50" rx="4" fill="var(--elevation-2)" stroke="#F59E0B" stroke-width="2"/>
                <!-- Circuit lines in chip -->
                <path d="M100 75V85" stroke="#F59E0B" stroke-width="2"/>
                <path d="M100 125V115" stroke="#F59E0B" stroke-width="2"/>
                <path d="M75 100H85" stroke="#F59E0B" stroke-width="2"/>
                <path d="M125 100H115" stroke="#F59E0B" stroke-width="2"/>
                <rect x="92" y="92" width="16" height="16" rx="2" fill="#F59E0B"/>
              </g>
              
              <!-- Processing Activity Particles -->
              <circle id="auto-particle-1" cx="80" cy="80" r="2" fill="#FFFFFF" opacity="0"/>
              <circle id="auto-particle-2" cx="120" cy="80" r="2" fill="#FFFFFF" opacity="0"/>
              <circle id="auto-particle-3" cx="120" cy="120" r="2" fill="#FFFFFF" opacity="0"/>
              <circle id="auto-particle-4" cx="80" cy="120" r="2" fill="#FFFFFF" opacity="0"/>
            </svg>
          </div>
          
          <div class="text-content">
            <h3 class="panel-title">AI Automation</h3>
            <p class="panel-description">
              <span class="highlight-phrase">Liberate your workflow.</span>
              Get rid of tedious work with AI, so you can focus on the essential things. Allow AI to support your daily work.
            </p>
          </div>
        </div>
      </section>
      <section class="vertical-panel panel-2">
        <div class="panel-background-text">MODERN WEB</div>
        <div class="panel-content">
          <div class="panel-icon-wrapper large-icon">
            <svg width="240" height="240" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Glow -->
              <circle cx="100" cy="100" r="80" fill="var(--color-primary-light)" fill-opacity="0.05" filter="blur(30px)" />
              
              <!-- Browser Window Frame -->
              <rect x="40" y="50" width="120" height="90" rx="4" stroke="var(--color-text-high)" stroke-width="2" fill="var(--elevation-2)" fill-opacity="0.8"/>
              <rect x="40" y="50" width="120" height="20" rx="4" fill="var(--elevation-3)"/>
              <circle cx="50" cy="60" r="3" fill="#EF4444"/>
              <circle cx="60" cy="60" r="3" fill="#F59E0B"/>
              <circle cx="70" cy="60" r="3" fill="#10B981"/>
              
              <!-- Scene: Code -->
              <g id="web-scene-code">
                <path id="web-line-1" d="M55 90H110" stroke="var(--color-text-medium)" stroke-width="2" stroke-linecap="round"/>
                <path id="web-line-2" d="M55 105H90" stroke="var(--color-text-medium)" stroke-width="2" stroke-linecap="round"/>
                <path id="web-line-3" d="M55 120H130" stroke="var(--color-text-medium)" stroke-width="2" stroke-linecap="round"/>
              </g>

              <!-- Scene: Window Layout -->
              <g id="web-scene-windows">
                <rect x="54" y="78" width="42" height="20" rx="3" fill="var(--elevation-1)" stroke="var(--color-primary-light)" stroke-opacity="0.6"/>
                <rect x="102" y="78" width="42" height="35" rx="3" fill="var(--elevation-1)" stroke="var(--color-primary-light)" stroke-opacity="0.6"/>
                <rect x="54" y="104" width="42" height="24" rx="3" fill="var(--elevation-1)" stroke="var(--color-primary-light)" stroke-opacity="0.6"/>
                <rect x="102" y="119" width="42" height="9" rx="3" fill="var(--color-primary-light)" fill-opacity="0.35"/>
              </g>

              <!-- Scene: Dashboard -->
              <g id="web-scene-dashboard">
                <rect x="55" y="78" width="18" height="52" rx="2" fill="var(--elevation-1)" stroke="var(--color-text-medium)" stroke-opacity="0.4"/>
                <rect x="79" y="78" width="65" height="14" rx="2" fill="var(--elevation-1)" stroke="var(--color-text-medium)" stroke-opacity="0.4"/>
                <rect x="79" y="98" width="20" height="32" rx="2" fill="var(--color-accent)" fill-opacity="0.3"/>
                <rect x="103" y="110" width="20" height="20" rx="2" fill="var(--color-primary-light)" fill-opacity="0.35"/>
                <rect x="127" y="102" width="17" height="28" rx="2" fill="#60A5FA" fill-opacity="0.3"/>
              </g>
              
              <!-- AI/LLM Connection (Floating Node) -->
              <circle cx="150" cy="150" r="25" fill="var(--elevation-1)" stroke="var(--color-accent)" stroke-width="2"/>
              <text x="150" y="155" font-family="Satoshi, sans-serif" font-size="14" font-weight="900" fill="var(--color-accent)" text-anchor="middle">LLM</text>
              
              <!-- API Gear/Node (Styled like LLM) -->
              <path d="M160 50C165 50 168 53 168 58" stroke="var(--color-primary-light)" stroke-width="2"/>
              <circle cx="160" cy="50" r="18" fill="var(--elevation-1)" stroke="var(--color-primary-light)" stroke-width="2"/>
              <text x="160" y="54" font-family="Satoshi, sans-serif" font-size="12" font-weight="900" fill="var(--color-primary-light)" text-anchor="middle">API</text>
            </svg>
          </div>
          
          <div class="text-content">
            <h3 class="panel-title">Web Development</h3>
            <p class="panel-description">
              <span class="highlight-phrase">Next-gen applications.</span>
              Classic web applications (API + Frontend) enhanced with LLMs and AI models.
              Robust, scalable systems that bridge traditional coding with modern intelligence.
            </p>
          </div>
        </div>
      </section>
      <section class="vertical-panel panel-3">
        <div class="panel-background-text">SECURE AI</div>
        <div class="panel-content">
          <div class="panel-icon-wrapper large-icon">
            <svg width="240" height="240" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Glow -->
              <circle cx="100" cy="100" r="80" fill="var(--color-status-success)" fill-opacity="0.05" filter="blur(30px)" />
              
              <!-- Outer Shield / Field (Pulsating) -->
              <path id="security-shield" d="M100 20C55 20 20 55 20 100C20 145 55 180 100 180C145 180 180 145 180 100C180 55 145 20 100 20Z" stroke="var(--color-status-success)" stroke-width="1" stroke-dasharray="2 4" opacity="0.5"/>
              
              <!-- Rotating Security Ring -->
              <g id="security-ring" transform-origin="100 100">
                <circle id="security-main-ring" cx="100" cy="100" r="60" stroke="var(--color-status-success)" stroke-width="2" stroke-dasharray="20 10"/>
                <circle cx="160" cy="100" r="4" fill="var(--color-status-success)"/>
                <circle cx="40" cy="100" r="4" fill="var(--color-status-success)"/>
                <circle cx="100" cy="160" r="4" fill="var(--color-status-success)"/>
                <circle cx="100" cy="40" r="4" fill="var(--color-status-success)"/>
              </g>

              <!-- Central Vault / Lock (Main focus) -->
              <g id="security-lock">
                <path d="M100 50L143.3 75V125L100 150L56.7 125V75L100 50Z" fill="var(--elevation-2)" stroke="var(--color-status-success)" stroke-width="3"/>
                <!-- Keyhole -->
                <circle cx="100" cy="95" r="8" fill="var(--color-status-success)"/>
                <path d="M100 95L92 120H108L100 95Z" fill="var(--color-status-success)"/>
              </g>
              
              <!-- Scanning Line (Animated) -->
              <path id="scan-line" d="M60 70H140" stroke="var(--color-accent)" stroke-width="2" stroke-opacity="0.8" />
            </svg>
          </div>
          
          <div class="text-content">
            <h3 class="panel-title">AI Trust & Security Solutions</h3>
            <p class="panel-description">
              <span class="highlight-phrase">Your data, your control.</span>
              We deploy local AI models with the highest security standardsâ€”ensuring your data never leaves your infrastructure. 
              With our <strong style="color: var(--color-text-high);">Human-in-the-Loop</strong> workflows, every critical AI result is verified by experts to minimize errors.
            </p>
          </div>
        </div>
      </section>
      <section class="vertical-panel panel-4">
        <div class="panel-background-text">FUTURE VISION</div>
        <div class="panel-content">
          <div class="panel-icon-wrapper large-icon">
            <svg width="240" height="240" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Glow -->
              <circle cx="100" cy="100" r="80" fill="#8B5CF6" fill-opacity="0.05" filter="blur(30px)" />
              
              <!-- Strategic Paths (Connecting Lines) - Animated Drawing -->
              <path id="strat-path-1" d="M100 100L100 40" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="2 2" opacity="0.6"/>
              <path id="strat-path-2" d="M100 100L152 130" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="2 2" opacity="0.6"/>
              <path id="strat-path-3" d="M100 100L48 130" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="2 2" opacity="0.6"/>
              
              <!-- Orbiting Nodes Group -->
              <g id="strat-orbits">
                <circle id="strat-main-ring" cx="100" cy="100" r="60" stroke="#8B5CF6" stroke-width="1" stroke-opacity="0.3" stroke-dasharray="6 6"/>
                <circle cx="100" cy="40" r="6" fill="#8B5CF6" stroke="var(--elevation-2)" stroke-width="2"/>
                <circle cx="152" cy="130" r="6" fill="#8B5CF6" stroke="var(--elevation-2)" stroke-width="2"/>
                <circle cx="48" cy="130" r="6" fill="#8B5CF6" stroke="var(--elevation-2)" stroke-width="2"/>
              </g>

              <!-- Central Vision / Core (Pulsing Star) -->
              <g id="strat-core">
                <!-- Outer diamond shape -->
                <path d="M100 75L125 100L100 125L75 100Z" fill="var(--elevation-2)" stroke="#C4B5FD" stroke-width="2"/>
                <!-- Inner star -->
                <path d="M100 85L105 95L115 100L105 105L100 115L95 105L85 100L95 95Z" fill="#8B5CF6"/>
              </g>
              
              <!-- Future Beams (Scanning outward) -->
              <path id="beam-1" d="M100 40L100 10" stroke="#C4B5FD" stroke-width="2" opacity="0" stroke-linecap="round"/>
              <path id="beam-2" d="M152 130L178 145" stroke="#C4B5FD" stroke-width="2" opacity="0" stroke-linecap="round"/>
              <path id="beam-3" d="M48 130L22 145" stroke="#C4B5FD" stroke-width="2" opacity="0" stroke-linecap="round"/>
            </svg>
          </div>
          
          <div class="text-content">
            <h3 class="panel-title">AI Strategy & Consulting</h3>
            <p class="panel-description">
              <span class="highlight-phrase">Navigate the future.</span>
              Don't implement AI blindly. We help you identify high-ROI opportunities and build a comprehensive <strong style="color: var(--color-text-high);">digital transformation roadmap</strong> tailored to your business goals.
            </p>
          </div>
        </div>
      </section>
    </div>
  </section>

  <Contact />

  <script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    const iElement = document.getElementById('mind-i') as HTMLSpanElement | null;
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const verticalStack = document.getElementById('vertical-stack');
    const verticalTrack = document.getElementById('vertical-track') as HTMLDivElement | null;
    const verticalPanels = Array.from(
      verticalStack?.querySelectorAll('.vertical-panel') ?? []
    ) as HTMLElement[];
    let verticalScrollTween: gsap.core.Tween | null = null;
    let pendingCall: gsap.core.Tween | null = null;
    let textRotationCall: gsap.core.Tween | null = null;

    if (!iElement) {
      console.warn('Animated title element not found.');
    } else if (prefersReducedMotion) {
      gsap.set(iElement, {
        display: 'inline-block',
        transformOrigin: 'center center',
        rotationX: 0,
        color: 'var(--color-accent)'
      });
    } else {
      const mindChar = iElement;

      gsap.set(mindChar, {
        display: 'inline-block',
        transformOrigin: 'center center',
        rotationX: 0,
        color: 'var(--color-accent)'
      });

      gsap.to('body', { autoAlpha: 1, duration: 0.5 });

      gsap.from('.title', {
        y: 50,
        opacity: 0,
        duration: 1,
        stagger: 0.2
      });

      gsap.from('.subtitle', {
        y: 20,
        opacity: 0,
        duration: 1,
        delay: 0.5
      });
      function scheduleNextFlip() {
        const randomDelay = Math.random() * 20 + 20;
        pendingCall = gsap.delayedCall(randomDelay, flipToIAndBack);
      }

      function flipToIAndBack() {
        const flipDuration = 0.5;
        const holdDuration = 2;

        gsap.timeline({
          onComplete: () => {
            scheduleNextFlip();
          }
        })
          .to(mindChar, {
            rotationX: 90,
            duration: flipDuration / 2,
            ease: 'power2.inOut'
          })
          .add(() => {
            mindChar.textContent = 'i';
            gsap.set(mindChar, { rotationX: -90, color: 'var(--color-text-high)' });
          })
          .to(mindChar, {
            rotationX: 0,
            duration: flipDuration / 2,
            ease: 'power2.inOut'
          })
          .to(mindChar, {
            duration: holdDuration
          })
          .to(mindChar, {
            rotationX: 90,
            duration: flipDuration / 2,
            ease: 'power2.inOut'
          })
          .add(() => {
            mindChar.textContent = '!';
            gsap.set(mindChar, { rotationX: -90, color: 'var(--color-accent)' });
          })
          .to(mindChar, {
            rotationX: 0,
            duration: flipDuration / 2,
            ease: 'power2.inOut'
          });
      }

      pendingCall = gsap.delayedCall(Math.random() * 5 + 2, scheduleNextFlip);

      // Text rotation logic
      const changingText = document.getElementById('changing-text');
      const words = ["Growth", "Results", "Leaders", "Efficiency", "Success", "Challenges", "Scale", "Productivity", "Precision", "Speed", "Impact", "Tomorrow", "Builders", "Business", "Needs"];
      let currentWordIndex = 0;

      if (changingText) {
        // Set initial style
        gsap.set(changingText, { display: 'inline-block' });

        function rotateText() {
          const nextWord = words[currentWordIndex];
          currentWordIndex = (currentWordIndex + 1) % words.length;

          gsap.to(changingText, {
            y: -20,
            opacity: 0,
            duration: 0.5,
            ease: 'power2.in',
            onComplete: () => {
              if (changingText) {
                changingText.textContent = nextWord;
                gsap.fromTo(changingText,
                  { y: 20, opacity: 0 },
                  { y: 0, opacity: 1, duration: 0.5, ease: 'power2.out' }
                );
              }
            }
          });
          
          textRotationCall = gsap.delayedCall(3.5, rotateText);
        }

        // Start the rotation loop after initial delay
        textRotationCall = gsap.delayedCall(3.5, rotateText);
      }

      // Web Dev Animation: Simulate lines changing length (scrolling/loading effect)
      const webSceneCode = document.getElementById('web-scene-code');
      const webSceneWindows = document.getElementById('web-scene-windows');
      const webSceneDashboard = document.getElementById('web-scene-dashboard');
      const webScenes = [webSceneCode, webSceneWindows, webSceneDashboard].filter(Boolean);

      if (webScenes.length === 3) {
        gsap.set(webScenes, { autoAlpha: 0 });
        gsap.set(webSceneCode, { autoAlpha: 1 });

        const webScenesLoop = gsap.timeline({ repeat: -1, repeatDelay: 0.3 });
        webScenesLoop
          .to({}, { duration: 2.8 })
          .to(webSceneCode, { autoAlpha: 0, duration: 0.22, ease: "sine.inOut" })
          .to(webSceneWindows, { autoAlpha: 1, duration: 0.22, ease: "sine.inOut" }, "<")
          .to({}, { duration: 2.8 })
          .to(webSceneWindows, { autoAlpha: 0, duration: 0.22, ease: "sine.inOut" })
          .to(webSceneDashboard, { autoAlpha: 1, duration: 0.22, ease: "sine.inOut" }, "<")
          .to({}, { duration: 2.8 })
          .to(webSceneDashboard, { autoAlpha: 0, duration: 0.22, ease: "sine.inOut" })
          .to(webSceneCode, { autoAlpha: 1, duration: 0.22, ease: "sine.inOut" }, "<");
      }

      const webLines = ['#web-line-1', '#web-line-2', '#web-line-3'];
      webLines.forEach((id, index) => {
        const line = document.querySelector(id);
        if (line) {
          gsap.set(line, { transformOrigin: "left center" });
          
          function animateLine() {
            gsap.to(line, {
              scaleX: Math.random() * 0.5 + 0.5, // Random scale between 0.5 and 1.0
              duration: 0.5 + Math.random() * 0.5, // Random duration
              ease: "power1.inOut",
              delay: Math.random() * 2, // Random delay
              onComplete: animateLine
            });
          }
          // Start slightly staggered
          gsap.delayedCall(index * 0.5, animateLine);
        }
      });

      // Security Animation: Rotating ring, pulsing shield, scanning line
      const securityRing = document.getElementById('security-ring');
      const securityMainRing = document.getElementById('security-main-ring');
      const securityShield = document.getElementById('security-shield');
      const scanLine = document.getElementById('scan-line');

      if (securityMainRing) {
        gsap.to(securityMainRing, {
          strokeDashoffset: -240,
          duration: 14,
          ease: "none",
          repeat: -1
        });
      }

      if (securityRing) {
        gsap.set(securityRing, { transformOrigin: "100px 100px" });
      }

      if (securityShield) {
        gsap.to(securityShield, {
          opacity: 0.8,
          scale: 1.05,
          duration: 2,
          yoyo: true,
          repeat: -1,
          ease: "sine.inOut",
          transformOrigin: "center center"
        });
      }
      
      if (scanLine) {
        gsap.fromTo(scanLine, 
          { y: 0, opacity: 0 },
          { 
            y: 60, 
            opacity: 1, 
            duration: 2, 
            repeat: -1, 
            yoyo: true,
            ease: "power1.inOut" 
          }
        );
      }

      // Strategy Animation: Pulsing core, rotating orbits, flashing beams
      const stratCore = document.getElementById('strat-core');
      const stratOrbits = document.getElementById('strat-orbits');
      const stratMainRing = document.getElementById('strat-main-ring');
      
      if (stratCore) {
        gsap.to(stratCore, {
          scale: 1.1,
          duration: 1.5,
          yoyo: true,
          repeat: -1,
          ease: "sine.inOut",
          transformOrigin: "center center"
        });
      }

      if (stratMainRing) {
        gsap.to(stratMainRing, {
          strokeDashoffset: -180,
          duration: 18,
          ease: "none",
          repeat: -1
        });
      }

      if (stratOrbits) {
        gsap.set(stratOrbits, { transformOrigin: "100px 100px" });
      }

      const beams = ['#beam-1', '#beam-2', '#beam-3'];
      beams.forEach((id, i) => {
        const beam = document.querySelector(id);
        if (beam) {
          gsap.fromTo(beam,
            { opacity: 0, scale: 0.8 },
            { 
              opacity: 1, 
              scale: 1.2,
              duration: 1,
              repeat: -1,
              yoyo: true,
              ease: "power2.out",
              delay: i * 0.6 // Staggered pulses
            }
          );
        }
      });

      // Automation Animation: Animated outer ring stroke, rotating mechanics, pulsing chip, flashing particles
      const autoGearOuter = document.getElementById('auto-gear-outer');
      const autoGearSegments = document.getElementById('auto-gear-segments');
      const autoOuterRing = document.getElementById('auto-outer-ring');
      const autoInnerRing = document.getElementById('auto-inner-ring');
      const autoMechanics = document.getElementById('auto-mechanics');
      const autoChip = document.getElementById('auto-chip');
      
      if (autoOuterRing) {
        gsap.to(autoOuterRing, {
          strokeDashoffset: -200,
          duration: 12,
          ease: "none",
          repeat: -1
        });
      }

      if (autoGearOuter) {
        gsap.set(autoGearOuter, { transformOrigin: "50% 50%" }); // Use element center
      }

      if (autoGearSegments) {
        gsap.set(autoGearSegments, { svgOrigin: "100 100" });
        gsap.to(autoGearSegments, {
          rotation: 360,
          duration: 22,
          ease: "none",
          repeat: -1
        });
      }

      if (autoInnerRing) {
        gsap.to(autoInnerRing, {
          strokeDashoffset: 200,
          duration: 10,
          ease: "none",
          repeat: -1
        });
      }

      if (autoMechanics) {
        gsap.set(autoMechanics, { transformOrigin: "50% 50%" }); // Use element center
      }

      if (autoChip) {
        gsap.set(autoChip, { transformOrigin: "center center" });
        gsap.to(autoChip, {
          scale: 1.05,
          duration: 0.8,
          yoyo: true,
          repeat: -1,
          ease: "sine.inOut"
        });
      }

      const particles = ['#auto-particle-1', '#auto-particle-2', '#auto-particle-3', '#auto-particle-4'];
      particles.forEach((id) => {
        const p = document.querySelector(id);
        if (p) {
          gsap.to(p, {
            opacity: 1,
            duration: 0.1,
            repeat: -1,
            yoyo: true,
            repeatDelay: Math.random() * 0.5,
            delay: Math.random() * 1
          });
        }
      });
    }

    const isCoarsePointer = window.matchMedia('(pointer: coarse)').matches;
    const enablePanelSnap = !prefersReducedMotion && !isCoarsePointer;

    if (verticalStack && verticalTrack && verticalPanels.length > 1) {
      const panelCount = verticalPanels.length;
      verticalScrollTween = gsap.to(verticalTrack, {
        x: () => -(verticalTrack.scrollWidth - window.innerWidth),
        ease: 'none',
        force3D: true,
        scrollTrigger: {
          id: 'horizontal-stack-scroll',
          trigger: verticalStack,
          pin: true,
          scrub: 0.35,
          snap: enablePanelSnap
            ? {
                snapTo: 1 / (panelCount - 1),
                duration: { min: 0.08, max: 0.22 },
                delay: 0.08,
                ease: 'power1.out'
              }
            : undefined,
          start: 'top top',
          end: () =>
            `+=${Math.max(
              window.innerWidth * (panelCount - 1),
              verticalTrack.scrollWidth - window.innerWidth
            )}`,
          anticipatePin: 1,
          fastScrollEnd: true,
          invalidateOnRefresh: true
        }
      });
    }

    window.addEventListener('beforeunload', () => {
      pendingCall?.kill();
      textRotationCall?.kill();
      verticalScrollTween?.kill();
    });
  </script>

  <style>
    main {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100%;
      gap: var(--space-3xs);
    }

    .title {
      font-family: 'Satoshi', sans-serif;
      font-weight: 900;
      font-size: var(--font-size-6xl);
      line-height: 1.1;
      margin: 0;
      letter-spacing: -0.02em;
      color: var(--color-text-high);
      text-transform: none;
      position: relative;
    }

    .title-top {
      right: 0;
    }

    .title-bottom {
      left: -0.117em;
      margin-top: -0.1em;
    }

    .subtitle {
      font-family: 'Satoshi', sans-serif;
      font-weight: 500;
      font-size: var(--font-size-xl);
      color: var(--color-text-medium);
      margin-top: var(--space-s);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      text-align: center;
      padding-inline: var(--space-m);
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 0.16em;
    }

    .subtitle-content {
      display: flex;
      align-items: baseline;
      gap: 0.3em; /* space between "for" and "Business" */
    }



    .highlight-text {
      display: inline-block;
      width: 7.5em; /* Fixed width to accommodate longest word "Productivity" */
      text-align: left;
    }



    .i-container {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 0.34em;
      position: relative;
    }

    .i {
      display: inline-block;
      transform-style: preserve-3d;
      transform-origin: center center;
      color: var(--color-accent);
      width: 100%;
      text-align: center;
    }

    .vertical-stack {
      height: 100vh;
      width: 100%;
      overflow: hidden;
      position: relative;
      overscroll-behavior: none;
    }

    .vertical-track {
      display: flex;
      flex-wrap: nowrap;
      width: 400vw;
      height: 100%;
      will-change: transform;
      transform: translate3d(0, 0, 0);
    }

    .vertical-panel {
      height: 100vh;
      width: 100vw;
      flex: 0 0 100vw;
      display: flex;
      align-items: center;
      justify-content: center;
      contain: layout paint;
    }

    .vertical-panel h3 {
      margin: 0;
      font-family: 'Satoshi', sans-serif;
      font-size: clamp(2rem, 8vw, 7rem);
      font-weight: 900;
      letter-spacing: 0.08em;
      color: #ffffff;
      text-transform: uppercase;
    }

    .panel-1 {
      background: radial-gradient(circle at 60% 40%, #92400e 0%, #451a03 100%); /* Darker Amber -> Dark Bronze */
      position: relative;
      overflow: hidden;
    }

    .panel-2 {
      background: radial-gradient(circle at 40% 60%, #1e40af 0%, #172554 100%); /* Deep Royal Blue -> Dark Navy */
      position: relative;
      overflow: hidden;
    }
    
    .panel-2 .panel-background-text {
      color: var(--color-primary-light);
    }
    
    .panel-2 .highlight-phrase {
      color: var(--color-primary-light);
    }

    .panel-3 {
      background: radial-gradient(circle at 50% 50%, var(--elevation-2) 0%, #064e3b 100%); /* Greenish tint at edges */
      position: relative;
      overflow: hidden;
    }
    
    .panel-3 .panel-background-text {
      color: var(--color-status-success);
    }
    
    .panel-3 .highlight-phrase {
      color: var(--color-status-success);
    }

    .panel-4 {
      background: radial-gradient(circle at 50% 50%, var(--elevation-3) 0%, #2e1065 100%); /* Deep Purple base */
      position: relative;
      overflow: hidden;
    }
    
    .panel-4 .panel-background-text {
      color: #8B5CF6; /* Violet */
    }
    
    .panel-4 .highlight-phrase {
      color: #8B5CF6;
    }

    @media (prefers-reduced-motion: reduce) {
      .i {
        transform: none;
      }

      .vertical-stack {
        height: auto;
      }

    }

    @media (max-width: 640px) {
      .subtitle {
        margin-top: var(--space-xs);
        font-size: var(--font-size-lg);
        letter-spacing: 0.03em;
      }

      .subtitle-content {
        flex-direction: column;
        align-items: center;
        gap: 0.1em;
      }

      .subtitle-content span:first-child {
        white-space: nowrap;
      }

      .highlight-text {
        width: 100%;
        min-height: 1.25em;
        text-align: center;
      }
    }

    .panel-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      max-width: 900px;
      padding: var(--space-xl);
      position: relative;
      z-index: 2; /* Sit above the background text */
    }

    .panel-background-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-15deg);
      font-family: 'Satoshi', sans-serif;
      font-weight: 900;
      font-size: 15vw; /* Massive size */
      color: var(--color-accent);
      opacity: 0.05;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1;
      text-transform: uppercase;
      letter-spacing: -0.05em;
    }

    .panel-title {
      font-family: 'Satoshi', sans-serif;
      font-size: var(--font-size-5xl);
      font-weight: 900;
      color: var(--color-text-high);
      margin-bottom: var(--space-s);
      text-transform: uppercase;
      letter-spacing: -0.02em;
      margin-top: 0;
      text-shadow: 0 4px 30px rgba(0,0,0,0.5);
    }

    .panel-description {
      font-family: 'Satoshi', sans-serif;
      font-size: var(--font-size-xl);
      color: var(--color-text-medium);
      line-height: 1.5;
      max-width: 50ch;
      margin: 0;
      font-weight: 400;
    }
    
    .panel-description .highlight-phrase {
      display: block;
      color: var(--color-text-high);
      font-weight: 700;
      font-size: 1.1em;
      margin-bottom: var(--space-xs);
      color: var(--color-accent);
    }

    .panel-icon-wrapper {
      margin-bottom: var(--space-l);
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 20px rgba(249, 115, 22, 0.2));
    }
  </style>
</Layout>
